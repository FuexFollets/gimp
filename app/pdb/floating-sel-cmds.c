/* LIGMA - The GNU Image Manipulation Program
 * Copyright (C) 1995-2003 Spencer Kimball and Peter Mattis
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

/* NOTE: This file is auto-generated by pdbgen.pl. */

#include "config.h"

#include "stamp-pdbgen.h"

#include <gegl.h>

#include <gdk-pixbuf/gdk-pixbuf.h>

#include "libligmabase/ligmabase.h"

#include "pdb-types.h"

#include "core/ligmadrawable.h"
#include "core/ligmaimage.h"
#include "core/ligmalayer-floating-selection.h"
#include "core/ligmalayer.h"
#include "core/ligmaparamspecs.h"

#include "ligmapdb.h"
#include "ligmapdberror.h"
#include "ligmapdb-utils.h"
#include "ligmaprocedure.h"
#include "internal-procs.h"

#include "ligma-intl.h"


static LigmaValueArray *
floating_sel_remove_invoker (LigmaProcedure         *procedure,
                             Ligma                  *ligma,
                             LigmaContext           *context,
                             LigmaProgress          *progress,
                             const LigmaValueArray  *args,
                             GError               **error)
{
  gboolean success = TRUE;
  LigmaLayer *floating_sel;

  floating_sel = g_value_get_object (ligma_value_array_index (args, 0));

  if (success)
    {
      if (ligma_layer_is_floating_sel (floating_sel))
        {
          ligma_image_remove_layer (ligma_item_get_image (LIGMA_ITEM (floating_sel)),
                                   floating_sel, TRUE, NULL);
        }
      else
        {
          g_set_error_literal (error, LIGMA_PDB_ERROR,
                               LIGMA_PDB_ERROR_INVALID_ARGUMENT,
                               _("Cannot remove this layer because "
                                 "it is not a floating selection."));
          success = FALSE;
        }
    }

  return ligma_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static LigmaValueArray *
floating_sel_anchor_invoker (LigmaProcedure         *procedure,
                             Ligma                  *ligma,
                             LigmaContext           *context,
                             LigmaProgress          *progress,
                             const LigmaValueArray  *args,
                             GError               **error)
{
  gboolean success = TRUE;
  LigmaLayer *floating_sel;

  floating_sel = g_value_get_object (ligma_value_array_index (args, 0));

  if (success)
    {
      if (ligma_layer_is_floating_sel (floating_sel))
        {
          floating_sel_anchor (floating_sel);
        }
      else
        {
          g_set_error_literal (error, LIGMA_PDB_ERROR,
                               LIGMA_PDB_ERROR_INVALID_ARGUMENT,
                               _("Cannot anchor this layer because "
                                 "it is not a floating selection."));
          success = FALSE;
        }
    }

  return ligma_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static LigmaValueArray *
floating_sel_to_layer_invoker (LigmaProcedure         *procedure,
                               Ligma                  *ligma,
                               LigmaContext           *context,
                               LigmaProgress          *progress,
                               const LigmaValueArray  *args,
                               GError               **error)
{
  gboolean success = TRUE;
  LigmaLayer *floating_sel;

  floating_sel = g_value_get_object (ligma_value_array_index (args, 0));

  if (success)
    {
      if (ligma_layer_is_floating_sel (floating_sel))
        {
          success = floating_sel_to_layer (floating_sel, error);
        }
      else
        {
          g_set_error_literal (error, LIGMA_PDB_ERROR,
                               LIGMA_PDB_ERROR_INVALID_ARGUMENT,
                               _("Cannot convert this layer to a normal layer "
                                 "because it is not a floating selection."));
          success = FALSE;
        }
    }

  return ligma_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

static LigmaValueArray *
floating_sel_attach_invoker (LigmaProcedure         *procedure,
                             Ligma                  *ligma,
                             LigmaContext           *context,
                             LigmaProgress          *progress,
                             const LigmaValueArray  *args,
                             GError               **error)
{
  gboolean success = TRUE;
  LigmaLayer *layer;
  LigmaDrawable *drawable;

  layer = g_value_get_object (ligma_value_array_index (args, 0));
  drawable = g_value_get_object (ligma_value_array_index (args, 1));

  if (success)
    {
      if (ligma_pdb_item_is_attached (LIGMA_ITEM (drawable), NULL,
                                     LIGMA_PDB_ITEM_CONTENT, error) &&
          ligma_pdb_item_is_not_group (LIGMA_ITEM (drawable), error))
        {
          /* see layer-new */
          if (ligma_drawable_is_gray (LIGMA_DRAWABLE (layer)) &&
              LIGMA_IS_LAYER (drawable))
            ligma_layer_fix_format_space (layer, TRUE, FALSE);

          floating_sel_attach (layer, drawable);
        }
      else
        success = FALSE;
    }

  return ligma_procedure_get_return_values (procedure, success,
                                           error ? *error : NULL);
}

void
register_floating_sel_procs (LigmaPDB *pdb)
{
  LigmaProcedure *procedure;

  /*
   * ligma-floating-sel-remove
   */
  procedure = ligma_procedure_new (floating_sel_remove_invoker);
  ligma_object_set_static_name (LIGMA_OBJECT (procedure),
                               "ligma-floating-sel-remove");
  ligma_procedure_set_static_help (procedure,
                                  "Remove the specified floating selection from its associated drawable.",
                                  "This procedure removes the floating selection completely, without any side effects. The associated drawable is then set to active.",
                                  NULL);
  ligma_procedure_set_static_attribution (procedure,
                                         "Spencer Kimball & Peter Mattis",
                                         "Spencer Kimball & Peter Mattis",
                                         "1995-1996");
  ligma_procedure_add_argument (procedure,
                               ligma_param_spec_layer ("floating-sel",
                                                      "floating sel",
                                                      "The floating selection",
                                                      FALSE,
                                                      LIGMA_PARAM_READWRITE));
  ligma_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * ligma-floating-sel-anchor
   */
  procedure = ligma_procedure_new (floating_sel_anchor_invoker);
  ligma_object_set_static_name (LIGMA_OBJECT (procedure),
                               "ligma-floating-sel-anchor");
  ligma_procedure_set_static_help (procedure,
                                  "Anchor the specified floating selection to its associated drawable.",
                                  "This procedure anchors the floating selection to its associated drawable. This is similar to merging with a merge type of ClipToBottomLayer. The floating selection layer is no longer valid after this operation.",
                                  NULL);
  ligma_procedure_set_static_attribution (procedure,
                                         "Spencer Kimball & Peter Mattis",
                                         "Spencer Kimball & Peter Mattis",
                                         "1995-1996");
  ligma_procedure_add_argument (procedure,
                               ligma_param_spec_layer ("floating-sel",
                                                      "floating sel",
                                                      "The floating selection",
                                                      FALSE,
                                                      LIGMA_PARAM_READWRITE));
  ligma_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * ligma-floating-sel-to-layer
   */
  procedure = ligma_procedure_new (floating_sel_to_layer_invoker);
  ligma_object_set_static_name (LIGMA_OBJECT (procedure),
                               "ligma-floating-sel-to-layer");
  ligma_procedure_set_static_help (procedure,
                                  "Transforms the specified floating selection into a layer.",
                                  "This procedure transforms the specified floating selection into a layer with the same offsets and extents. The composited image will look precisely the same, but the floating selection layer will no longer be clipped to the extents of the drawable it was attached to. The floating selection will become the active layer. This procedure will not work if the floating selection has a different base type from the underlying image. This might be the case if the floating selection is above an auxiliary channel or a layer mask.",
                                  NULL);
  ligma_procedure_set_static_attribution (procedure,
                                         "Spencer Kimball & Peter Mattis",
                                         "Spencer Kimball & Peter Mattis",
                                         "1995-1996");
  ligma_procedure_add_argument (procedure,
                               ligma_param_spec_layer ("floating-sel",
                                                      "floating sel",
                                                      "The floating selection",
                                                      FALSE,
                                                      LIGMA_PARAM_READWRITE));
  ligma_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);

  /*
   * ligma-floating-sel-attach
   */
  procedure = ligma_procedure_new (floating_sel_attach_invoker);
  ligma_object_set_static_name (LIGMA_OBJECT (procedure),
                               "ligma-floating-sel-attach");
  ligma_procedure_set_static_help (procedure,
                                  "Attach the specified layer as floating to the specified drawable.",
                                  "This procedure attaches the layer as floating selection to the drawable.",
                                  NULL);
  ligma_procedure_set_static_attribution (procedure,
                                         "Spencer Kimball & Peter Mattis",
                                         "Spencer Kimball & Peter Mattis",
                                         "1995-1996");
  ligma_procedure_add_argument (procedure,
                               ligma_param_spec_layer ("layer",
                                                      "layer",
                                                      "The layer (is attached as floating selection)",
                                                      FALSE,
                                                      LIGMA_PARAM_READWRITE));
  ligma_procedure_add_argument (procedure,
                               ligma_param_spec_drawable ("drawable",
                                                         "drawable",
                                                         "The drawable (where to attach the floating selection)",
                                                         FALSE,
                                                         LIGMA_PARAM_READWRITE));
  ligma_pdb_register_procedure (pdb, procedure);
  g_object_unref (procedure);
}
